{"ast":null,"code":"import React,{useState,useContext}from\"react\";import MenuItem from\"@material-ui/core/MenuItem\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import ConfirmationModal from\"../ConfirmationModal\";import{Menu}from\"@material-ui/core\";import{ReplyMessageContext}from\"../../context/ReplyingMessage/ReplyingMessageContext\";import{ForwardMessageContext}from\"../../context/ForwarMessage/ForwardMessageContext\";import{TicketsContext}from\"../../context/Tickets/TicketsContext\";import{v4 as uuidv4}from\"uuid\";import toastError from\"../../errors/toastError\";import{useHistory}from\"react-router-dom\";import{AuthContext}from\"../../context/Auth/AuthContext\";import ForwardModal from\"../../components/ForwardMessageModal\";import ShowTicketOpen from\"../ShowTicketOpenModal\";const MessageOptionsMenu=_ref=>{let{message,menuOpen,handleClose,anchorEl,isGroup,queueId,whatsappId}=_ref;const{setReplyingMessage}=useContext(ReplyMessageContext);const[confirmationOpen,setConfirmationOpen]=useState(false);const{user}=useContext(AuthContext);const history=useHistory();const{setCurrentTicket}=useContext(TicketsContext);const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const{showSelectMessageCheckbox,setShowSelectMessageCheckbox,selectedMessages,forwardMessageModalOpen,setForwardMessageModalOpen}=useContext(ForwardMessageContext);const handleSelectTicket=ticket=>{const code=uuidv4();const{id,uuid}=ticket;setCurrentTicket({id,uuid,code});};const handleSaveTicket=async contactId=>{if(!contactId)return;try{const{data:ticket}=await api.post(\"/tickets\",{contactId:contactId,userId:user===null||user===void 0?void 0:user.id,status:\"open\",queueId:queueId,whatsappId:whatsappId});handleSelectTicket(ticket);history.push(\"/tickets/\".concat(ticket.uuid));}catch(err){const ticket=JSON.parse(err.response.data.error);if(ticket.userId!==(user===null||user===void 0?void 0:user.id)){setOpenAlert(true);setUserTicketOpen(ticket.user.name);setQueueTicketOpen(ticket.queue.name);}else{setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");handleSelectTicket(ticket);history.push(\"/tickets/\".concat(ticket.uuid));}}//setLoading(false);\nhandleClose();};const handleCloseAlert=()=>{setOpenAlert(false);setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");};const handleSetShowSelectCheckbox=()=>{setShowSelectMessageCheckbox(!showSelectMessageCheckbox);handleClose();};const handleDeleteMessage=async()=>{try{await api.delete(\"/messages/\".concat(message.id));}catch(err){toastError(err);}};// const handleForwardMessage = (msg) => {\n//   setForwardModalOpen(true);\n//   setForwardMessage(msg);\n//   handleClose();\n// };\n// const handleCloseForwardModal = () => {\n//   //setSelectedSchedule(null);\n//   setForwardModalOpen(false);\n//   handleClose();\n// };\nconst hanldeReplyMessage=()=>{setReplyingMessage(message);handleClose();};const handleOpenConfirmationModal=e=>{setConfirmationOpen(true);handleClose();};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),/*#__PURE__*/React.createElement(ConfirmationModal,{title:i18n.t(\"messageOptionsMenu.confirmationModal.title\"),open:confirmationOpen,onClose:setConfirmationOpen,onConfirm:handleDeleteMessage},i18n.t(\"messageOptionsMenu.confirmationModal.message\")),/*#__PURE__*/React.createElement(ForwardModal,{modalOpen:forwardMessageModalOpen,messages:selectedMessages,onClose:e=>{setForwardMessageModalOpen(false);setShowSelectMessageCheckbox(false);}}),/*#__PURE__*/React.createElement(Menu,{anchorEl:anchorEl,getContentAnchorEl:null,anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},transformOrigin:{vertical:\"top\",horizontal:\"right\"},open:menuOpen,onClose:handleClose},message.fromMe&&/*#__PURE__*/React.createElement(MenuItem,{onClick:handleOpenConfirmationModal},i18n.t(\"messageOptionsMenu.delete\")),/*#__PURE__*/React.createElement(MenuItem,{onClick:hanldeReplyMessage},i18n.t(\"messageOptionsMenu.reply\")),/*#__PURE__*/React.createElement(MenuItem,{onClick:handleSetShowSelectCheckbox},i18n.t(\"messageOptionsMenu.forward\")),!message.fromMe&&isGroup&&/*#__PURE__*/React.createElement(MenuItem,{onClick:()=>{var _message$contact;return handleSaveTicket(message===null||message===void 0?void 0:(_message$contact=message.contact)===null||_message$contact===void 0?void 0:_message$contact.id);}},i18n.t(\"messageOptionsMenu.talkTo\"))));};export default MessageOptionsMenu;","map":null,"metadata":{},"sourceType":"module"}