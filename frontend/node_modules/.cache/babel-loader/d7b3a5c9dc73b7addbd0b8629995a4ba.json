{"ast":null,"code":"import React,{useState,useContext,useEffect,useMemo}from\"react\";import clsx from\"clsx\";import moment from\"moment\";import{isNill}from\"lodash\";import SoftPhone from\"react-softphone\";import{WebSocketInterface}from\"jssip\";import{makeStyles,Drawer,AppBar,Toolbar,List,Typography,Divider,MenuItem,IconButton,Menu,useTheme,useMediaQuery,Avatar,FormControl,Badge,withStyles,Chip}from\"@material-ui/core\";import MenuIcon from\"@material-ui/icons/Menu\";import ChevronLeftIcon from\"@material-ui/icons/ChevronLeft\";import AccountCircle from\"@material-ui/icons/AccountCircle\";import CachedIcon from\"@material-ui/icons/Cached\";import whatsappIcon from\"../assets/nopicture.png\";import MainListItems from\"./MainListItems\";import NotificationsPopOver from\"../components/NotificationsPopOver\";import NotificationsVolume from\"../components/NotificationsVolume\";import UserModal from\"../components/UserModal\";import{AuthContext}from\"../context/Auth/AuthContext\";import BackdropLoading from\"../components/BackdropLoading\";import DarkMode from\"../components/DarkMode\";import{i18n}from\"../translate/i18n\";import toastError from\"../errors/toastError\";import AnnouncementsPopover from\"../components/AnnouncementsPopover\";import logo from\"../assets/logo.png\";import{socketConnection}from\"../services/socket\";import ChatPopover from\"../pages/Chat/ChatPopover\";import{useDate}from\"../hooks/useDate\";import UserLanguageSelector from\"../components/UserLanguageSelector\";import ColorModeContext from\"../layout/themeContext\";import Brightness4Icon from\"@material-ui/icons/Brightness4\";import Brightness7Icon from\"@material-ui/icons/Brightness7\";import{getBackendUrl}from\"../config\";import useSettings from\"../hooks/useSettings\";const backendUrl=getBackendUrl();const drawerWidth=240;const useStyles=makeStyles(theme=>({root:{display:\"flex\",height:\"100vh\",[theme.breakpoints.down(\"sm\")]:{height:\"calc(100vh - 56px)\"},backgroundColor:theme.palette.fancyBackground,\"& .MuiButton-outlinedPrimary\":{color:theme.mode===\"light\"?\"#065183\":\"#FFF\",border:theme.mode===\"light\"?\"1px solid rgba(0 124 102)\":\"1px solid rgba(255, 255, 255, 0.5)\"},\"& .MuiTab-textColorPrimary.Mui-selected\":{color:theme.mode===\"light\"?\"#065183\":\"#FFF\"}},chip:{background:\"red\",color:\"white\"},avatar:{width:\"100%\"},toolbar:{paddingRight:24,// keep right padding when drawer closed\ncolor:theme.palette.dark.main,background:theme.palette.barraSuperior},toolbarIcon:{display:\"flex\",alignItems:\"center\",justifyContent:\"flex-end\",// backgroundColor: \"#FFF\",\nbackgroundSize:\"cover\",padding:\"0 8px\",minHeight:\"48px\",[theme.breakpoints.down(\"sm\")]:{height:\"48px\"}},appBar:{zIndex:theme.zIndex.drawer+1,transition:theme.transitions.create([\"width\",\"margin\"],{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen})},appBarShift:{marginLeft:drawerWidth,width:\"calc(100% - \".concat(drawerWidth,\"px)\"),transition:theme.transitions.create([\"width\",\"margin\"],{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.enteringScreen}),[theme.breakpoints.down(\"sm\")]:{display:\"none\"}},menuButton:{marginRight:36},menuButtonHidden:{display:\"none\"},title:{flexGrow:1,fontSize:14,color:\"white\"},drawerPaper:{position:\"relative\",whiteSpace:\"nowrap\",width:drawerWidth,transition:theme.transitions.create(\"width\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.enteringScreen})},drawerPaperClose:{overflowX:\"hidden\",transition:theme.transitions.create(\"width\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen}),width:theme.spacing(7),[theme.breakpoints.up(\"sm\")]:{width:theme.spacing(9)}},appBarSpacer:{minHeight:\"48px\"},content:{flex:1,overflow:\"auto\"},container:{paddingTop:theme.spacing(4),paddingBottom:theme.spacing(4)},paper:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\"},containerWithScroll:{flex:1,padding:theme.spacing(1),overflowY:\"scroll\",...theme.scrollbarStyles},NotificationsPopOver:{// color: theme.barraSuperior.secondary.main,\n},logo:{width:\"100%\",height:\"48px\",maxWidth:180,[theme.breakpoints.down(\"sm\")]:{width:\"auto\",height:\"100%\",maxWidth:180},logo:theme.logo},avatar2:{width:theme.spacing(4),height:theme.spacing(4),cursor:\"pointer\",borderRadius:\"50%\",border:\"2px solid #ccc\"},updateDiv:{display:\"flex\",flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\"}}));const StyledBadge=withStyles(theme=>({badge:{backgroundColor:\"#44b700\",color:\"#44b700\",boxShadow:\"0 0 0 2px \".concat(theme.palette.background.paper),\"&::after\":{position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\",borderRadius:\"50%\",animation:\"$ripple 1.2s infinite ease-in-out\",border:\"1px solid currentColor\",content:'\"\"'}},\"@keyframes ripple\":{\"0%\":{transform:\"scale(.8)\",opacity:1},\"100%\":{transform:\"scale(2.4)\",opacity:0}}}))(Badge);const SmallAvatar=withStyles(theme=>({root:{width:22,height:22,border:\"2px solid \".concat(theme.palette.background.paper)}}))(Avatar);const LoggedInLayout=_ref=>{var _user$company,_user$company2,_user$company3,_user$company4;let{children,themeToggle}=_ref;const classes=useStyles();const[userToken,setUserToken]=useState(\"disabled\");const[loadingUserToken,setLoadingUserToken]=useState(false);const[userModalOpen,setUserModalOpen]=useState(false);const[anchorEl,setAnchorEl]=useState(null);const[menuOpen,setMenuOpen]=useState(false);const{handleLogout,loading}=useContext(AuthContext);const[drawerOpen,setDrawerOpen]=useState(false);const[drawerVariant,setDrawerVariant]=useState(\"permanent\");// const [dueDate, setDueDate] = useState(\"\");\nconst{user}=useContext(AuthContext);const theme=useTheme();const{colorMode}=useContext(ColorModeContext);const greaterThenSm=useMediaQuery(theme.breakpoints.up(\"sm\"));const[volume,setVolume]=useState(localStorage.getItem(\"volume\")||1);const{dateToClient}=useDate();const[profileUrl,setProfileUrl]=useState(null);// eslint-disable-next-line react-hooks/exhaustive-deps\nconst mainListItems=useMemo(()=>/*#__PURE__*/React.createElement(MainListItems,{drawerOpen:drawerOpen,collapsed:!drawerOpen}),[user,drawerOpen]);const settings=useSettings();const config={domain:\"192.168.2.4\",// sip-server@your-domain.io\nuri:\"sip:202@192.168.2.4\",// sip:sip-user@your-domain.io\npassword:\"btelefonia12\",//  PASSWORD ,\nws_servers:\"wss://202@192.168.2.4:8089/ws\",//ws server\nsockets:new WebSocketInterface(\"wss://192.168.2.4:8089/ws\"),display_name:\"202\",//jssip Display Name\nwebsocket_url:\"wss://192.168.2.4:443\",sip_outbound_ur:\"udp://192.168.2.4:5060\",debug:true// Turn debug messages on\n};const setConnectOnStartToLocalStorage=newValue=>{// Handle save the auto connect value to local storage\nreturn true;};const setNotifications=newValue=>{// Handle save the Show notifications of an incoming call to local storage\nreturn true;};const setCallVolume=newValue=>{// Handle save the call Volume value to local storage\nreturn true;};const setRingVolume=newValue=>{// Handle save the Ring Volume value to local storage\nreturn true;};//################### CODIGOS DE TESTE #########################################\n// useEffect(() => {\n//   navigator.getBattery().then((battery) => {\n//     console.log(`Battery Charging: ${battery.charging}`);\n//     console.log(`Battery Level: ${battery.level * 100}%`);\n//     console.log(`Charging Time: ${battery.chargingTime}`);\n//     console.log(`Discharging Time: ${battery.dischargingTime}`);\n//   })\n// }, []);\n// useEffect(() => {\n//   const geoLocation = navigator.geolocation\n//   geoLocation.getCurrentPosition((position) => {\n//     let lat = position.coords.latitude;\n//     let long = position.coords.longitude;\n//     console.log('latitude: ', lat)\n//     console.log('longitude: ', long)\n//   })\n// }, []);\n// useEffect(() => {\n//   const nucleos = window.navigator.hardwareConcurrency;\n//   console.log('Nucleos: ', nucleos)\n// }, []);\n// useEffect(() => {\n//   console.log('userAgent', navigator.userAgent)\n//   if (\n//     navigator.userAgent.match(/Android/i)\n//     || navigator.userAgent.match(/webOS/i)\n//     || navigator.userAgent.match(/iPhone/i)\n//     || navigator.userAgent.match(/iPad/i)\n//     || navigator.userAgent.match(/iPod/i)\n//     || navigator.userAgent.match(/BlackBerry/i)\n//     || navigator.userAgent.match(/Windows Phone/i)\n//   ) {\n//     console.log('é mobile ', true) //celular\n//   }\n//   else {\n//     console.log('não é mobile: ', false) //nao é celular\n//   }\n// }, []);\n//##############################################################################\nuseEffect(()=>{const getSetting=async()=>{const response=await settings.get(\"wtV\");if(response){setUserToken(response.value);}else{setUserToken(\"enabled\");}};getSetting();});useEffect(()=>{if(document.body.offsetWidth>600){if(user.defaultMenu===\"closed\"){setDrawerOpen(false);}else{setDrawerOpen(true);}}if(user.defaultTheme===\"dark\"&&theme.mode===\"light\"){toggleColorMode();}},[user]);useEffect(()=>{if(document.body.offsetWidth<600){setDrawerVariant(\"temporary\");}else{setDrawerVariant(\"permanent\");}},[drawerOpen]);useEffect(()=>{const companyId=user.companyId;const userId=user.id;if(companyId){const socket=socketConnection({companyId,userId:user.id});const ImageUrl=user.profileImage;if(ImageUrl!==undefined&&ImageUrl!==null)setProfileUrl(\"\".concat(backendUrl,\"/public/company\").concat(companyId,\"/user/\").concat(ImageUrl));else setProfileUrl(\"\".concat(process.env.FRONTEND_URL,\"/nopicture.png\"));socket.on(\"company-\".concat(companyId,\"-auth\"),data=>{if(data.user.id===+userId){toastError(\"Sua conta foi acessada em outro computador.\");setTimeout(()=>{localStorage.clear();window.location.reload();},1000);}});socket.emit(\"userStatus\");const interval=setInterval(()=>{socket.emit(\"userStatus\");},1000*60*5);return()=>{socket.disconnect();clearInterval(interval);};}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[user]);const handleMenu=event=>{setAnchorEl(event.currentTarget);setMenuOpen(true);};const handleCloseMenu=()=>{setAnchorEl(null);setMenuOpen(false);};const handleOpenUserModal=()=>{setUserModalOpen(true);handleCloseMenu();};const handleClickLogout=()=>{if(theme.mode===\"dark\")toggleColorMode();handleCloseMenu();handleLogout();};const drawerClose=()=>{if(document.body.offsetWidth<600||user.defaultMenu===\"closed\"){setDrawerOpen(false);}};const handleRefreshPage=()=>{window.location.reload(false);};const handleMenuItemClick=()=>{const{innerWidth:width}=window;if(width<=600){setDrawerOpen(false);}};const toggleColorMode=()=>{colorMode.toggleColorMode();};if(loading){return/*#__PURE__*/React.createElement(BackdropLoading,null);}return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(Drawer,{variant:drawerVariant,className:drawerOpen?classes.drawerPaper:classes.drawerPaperClose,classes:{paper:clsx(classes.drawerPaper,!drawerOpen&&classes.drawerPaperClose)},open:drawerOpen},/*#__PURE__*/React.createElement(\"div\",{className:classes.toolbarIcon},/*#__PURE__*/React.createElement(\"img\",{src:logo,style:{display:\"block\",margin:\"0 auto\",height:\"50px\",width:\"100%\"},alt:\"logo\"}),/*#__PURE__*/React.createElement(IconButton,{onClick:()=>setDrawerOpen(!drawerOpen)},/*#__PURE__*/React.createElement(ChevronLeftIcon,null))),/*#__PURE__*/React.createElement(List,{className:classes.containerWithScroll},mainListItems),/*#__PURE__*/React.createElement(Divider,null)),/*#__PURE__*/React.createElement(AppBar,{position:\"absolute\",className:clsx(classes.appBar,drawerOpen&&classes.appBarShift),color:\"primary\"},/*#__PURE__*/React.createElement(Toolbar,{variant:\"dense\",className:classes.toolbar},/*#__PURE__*/React.createElement(IconButton,{edge:\"start\",variant:\"contained\",\"aria-label\":\"open drawer\",style:{color:\"white\"},onClick:()=>setDrawerOpen(!drawerOpen),className:clsx(classes.menuButton,drawerOpen&&classes.menuButtonHidden)},/*#__PURE__*/React.createElement(MenuIcon,null)),/*#__PURE__*/React.createElement(Typography,{component:\"h2\",variant:\"h6\",color:\"inherit\",noWrap:true,className:classes.title},greaterThenSm&&(user===null||user===void 0?void 0:user.profile)===\"admin\"&&(user===null||user===void 0?void 0:(_user$company=user.company)===null||_user$company===void 0?void 0:_user$company.dueDate)?/*#__PURE__*/React.createElement(React.Fragment,null,i18n.t(\"mainDrawer.appBar.user.message\"),\" \",/*#__PURE__*/React.createElement(\"b\",null,user.name),\",\",\" \",i18n.t(\"mainDrawer.appBar.user.messageEnd\"),\" \",/*#__PURE__*/React.createElement(\"b\",null,user===null||user===void 0?void 0:(_user$company2=user.company)===null||_user$company2===void 0?void 0:_user$company2.name),\"! (\",i18n.t(\"mainDrawer.appBar.user.active\"),\" \",dateToClient(user===null||user===void 0?void 0:(_user$company3=user.company)===null||_user$company3===void 0?void 0:_user$company3.dueDate),\")\"):/*#__PURE__*/React.createElement(React.Fragment,null,i18n.t(\"mainDrawer.appBar.user.message\"),\" \",/*#__PURE__*/React.createElement(\"b\",null,user.name),\",\",\" \",i18n.t(\"mainDrawer.appBar.user.messageEnd\"),\" \",/*#__PURE__*/React.createElement(\"b\",null,user===null||user===void 0?void 0:(_user$company4=user.company)===null||_user$company4===void 0?void 0:_user$company4.name),\"!\")),/*#__PURE__*/React.createElement(IconButton,{edge:\"start\",onClick:toggleColorMode},theme.mode===\"dark\"?/*#__PURE__*/React.createElement(Brightness7Icon,{style:{color:\"white\"}}):/*#__PURE__*/React.createElement(Brightness4Icon,{style:{color:\"white\"}})),/*#__PURE__*/React.createElement(NotificationsVolume,{setVolume:setVolume,volume:volume}),/*#__PURE__*/React.createElement(IconButton,{onClick:handleRefreshPage,\"aria-label\":i18n.t(\"mainDrawer.appBar.refresh\"),color:\"inherit\"},/*#__PURE__*/React.createElement(CachedIcon,{style:{color:\"white\"}})),user.id&&/*#__PURE__*/React.createElement(NotificationsPopOver,{volume:volume}),/*#__PURE__*/React.createElement(AnnouncementsPopover,null),/*#__PURE__*/React.createElement(ChatPopover,null),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(StyledBadge,{overlap:\"circular\",anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},variant:\"dot\",onClick:handleMenu},/*#__PURE__*/React.createElement(Avatar,{alt:\"Whaticket\",className:classes.avatar2,src:profileUrl})),/*#__PURE__*/React.createElement(UserModal,{open:userModalOpen,onClose:()=>setUserModalOpen(false),onImageUpdate:newProfileUrl=>setProfileUrl(newProfileUrl),userId:user===null||user===void 0?void 0:user.id}),/*#__PURE__*/React.createElement(Menu,{id:\"menu-appbar\",anchorEl:anchorEl,getContentAnchorEl:null,anchorOrigin:{vertical:\"bottom\",horizontal:\"right\"},transformOrigin:{vertical:\"top\",horizontal:\"right\"},open:menuOpen,onClose:handleCloseMenu},/*#__PURE__*/React.createElement(MenuItem,{onClick:handleOpenUserModal},i18n.t(\"mainDrawer.appBar.user.profile\")),/*#__PURE__*/React.createElement(MenuItem,{onClick:handleClickLogout},i18n.t(\"mainDrawer.appBar.user.logout\")))))),/*#__PURE__*/React.createElement(\"main\",{className:classes.content},/*#__PURE__*/React.createElement(\"div\",{className:classes.appBarSpacer}),children?children:null));};export default LoggedInLayout;","map":null,"metadata":{},"sourceType":"module"}